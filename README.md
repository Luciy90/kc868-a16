# KC868-A16 ESPHome Configuration

Конфигурация ESPHome для контроллера Kincony KC868-A16.

## Описание

Этот проект содержит конфигурацию ESPHome для платы Kincony KC868-A16, которая обеспечивает:
- 16 реле для управления нагрузками
- 16 цифровых входов для датчиков
- Поддержку датчиков температуры DS18B20
- Подключение через Ethernet (LAN8720)

## Требования

- ESPHome установлен и настроен
- Python 3.7 или выше
- Git

## Установка

1. Клонируйте репозиторий:
```bash
git clone <ваш-репозиторий-url>
cd kc868-a16
```

2. Создайте файл `secrets.yaml` на основе `secrets.yaml.example`:
```bash
cp secrets.yaml.example secrets.yaml
```

3. Отредактируйте `secrets.yaml` и укажите ваши настройки:
   - API ключ шифрования
   - OTA пароль
   - IP адрес (если нужен статический)

4. Установите зависимости ESPHome (если еще не установлены):
```bash
pip install esphome
```

## Настройка

### Сеть

По умолчанию используется статический IP адрес `192.168.0.99`. Измените настройки в `kc868-a16-a.yaml` в секции `ethernet.manual_ip` под вашу сеть.

### I2C адреса PCF8574

Конфигурация использует следующие адреса:
- Входы 1-8: `0x22`
- Входы 9-16: `0x21`
- Реле 1-8: `0x24`
- Реле 9-16: `0x25`

Если ваша плата использует другие адреса, проверьте логи после первой прошивки (включен `i2c.scan: true`) и обновите адреса в конфигурации.

### Датчики температуры

Датчики DS18B20 подключены к GPIO15 через OneWire. Если датчики не используются, закомментируйте секцию `sensor` с `dallas_temp` или установите `disabled_by_default: true`.

## Компиляция и прошивка

### Через ESPHome Dashboard

1. Откройте ESPHome Dashboard
2. Добавьте устройство, выбрав файл `kc868-a16-a.yaml`
3. Нажмите "Install" и выберите способ прошивки (USB или OTA)

### Через командную строку

```bash
# Валидация конфигурации
esphome config kc868-a16-a.yaml

# Компиляция
esphome compile kc868-a16-a.yaml

# Прошивка через USB
esphome upload kc868-a16-a.yaml --device /dev/ttyUSB0

# Или прошивка через OTA (после первой прошивки)
esphome upload kc868-a16-a.yaml
```

## Интеграция с Home Assistant

После прошивки устройство автоматически появится в Home Assistant через ESPHome API. Убедитесь, что:
- Home Assistant и устройство находятся в одной сети
- API ключ в конфигурации совпадает (или используйте автоматическое обнаружение)

## Структура проекта

```
kc868-a16/
├── kc868-a16-a.yaml      # Основная конфигурация ESPHome
├── secrets.yaml           # Секретные данные (не коммитится)
├── secrets.yaml.example   # Пример файла с секретами
├── .gitignore            # Игнорируемые файлы
└── README.md             # Этот файл
```

## Устранение неполадок

### Устройство не появляется в сети

1. Проверьте подключение Ethernet кабеля
2. Проверьте настройки IP адреса и шлюза
3. Проверьте логи через Serial порт

### Реле или входы не работают

1. Проверьте логи - должны быть видны найденные I2C устройства
2. Убедитесь, что адреса PCF8574 совпадают с логами
3. Проверьте подключение I2C шины (SDA/SCL)

### Датчики температуры не работают

1. Убедитесь, что датчики подключены к GPIO15
2. Проверьте питание датчиков (нужен внешний источник 3.3V)
3. Проверьте логи на наличие ошибок OneWire

## Лицензия

MIT

## Автор

Создано для проекта автоматизации на базе Kincony KC868-A16

